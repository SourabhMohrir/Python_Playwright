pipeline {
  agent any

  parameters {
    choice(name: 'SUITE', choices: "API\nregression", description: 'Select test suite')
  }

  environment {
    PLAYWRIGHT_CRED = credentials('87210547-55f4-4ace-8479-bcf9ed6610b1')
  }

  stages {
    stage('Run Tests') {
      steps {
        withEnv([
          "USER_EMAIL_1=${PLAYWRIGHT_CRED_USR}",
          "USER_PASSWORD_1=${PLAYWRIGHT_CRED_PSW}"
        ]) {
          sh './ci/run_tests.sh'
        }
      }
    }
  }

  post {
    always {
      node {
        archiveArtifacts artifacts: 'playwright-report/**/*', allowEmptyArchive: true
      }
    }
  }
}
