pipeline {
  agent any
  parameters { /* ... */ }
  environment {
    PLAYWRIGHT_CRED = credentials('...')
  }

  stages {
    stage('Setup Node') {
      steps {
        script {
          def nodeHome = tool name: 'node24', type: 'jenkins.plugins.nodejs.tools.NodeJSInstallation'
          env.PATH = "${nodeHome}/bin:${env.PATH}"
        }
      }
    }
    stage('Install & Test') {
      steps {
        dir('PythonPlaywright') {
          sh 'npm ci'
          sh 'npx playwright install --with-deps'
          withEnv([
            "USER_EMAIL_1=${PLAYWRIGHT_CRED_USR}",
            "USER_PASSWORD_1=${PLAYWRIGHT_CRED_PSW}"
          ]) {
            sh './ci/test_runs.sh'
          }
        }
      }
    }
  }

  post {
    always {
      archiveArtifacts artifacts: 'PythonPlaywright/playwright-report/**/*', allowEmptyArchive: true
    }
  }
}